
<h1>The 5 minutes introduction to Firewall Builder 3.1.0</h1>

<!--
<p>
<b><i>This message is shown once, you will not see it again on
    subsequent runs of the program.</i></b> You can find the same
    information, and more, on the web site in the
    section <a href="http://www.fwbuilder.org/docs/firewall_builder_release_notes.html">"Release
    Notes"</a>.
</p>
-->

<p>
  <i>Firewall Builder v3.1.0 is internal testing release not intended
  for publication. Please do not distribute it. This version is
  preliminary, not suitable for production use, most likely has bugs
  and is made available for download to make it possible for selected
  users to test it and validate most important design decisions.</i>
</p>

<p>
  <b><i>You can keep this window open while you are working with the
  GUI or open it again using main menu Help/Release Notes.</i></b>
</p>

<p>
  <ul>
    <li><a href="#gui">Changes in the GUI</a></li>
    <li><a href="#cluster">Support for High Availability configurations</a></li>
    <li><a href="#pix_cluster">Cluster configuration for PIX</a></li>
    <li><a href="#bridge">Changes in the support for bridging firewalls</a></li>
  </ul>
</p>


<a name="gui"></a>
<h2>Changes in the GUI</h2>

<p>
  <b>The editor panel and object tree are now detachable.</b> You can
  "float" these windows and rearrange them on the screen any way you
  want. There is only one editor panel even when you open several data
  files at the dame time. Each data file is opened in its own project
  window with object tree and rules.
</p>

<p>
  Selection of the object in the tree or rules does not automatically
  open it in the editor anymore. Use double click or context menu item
  "Edit" to open object in the editor. This helps, for example, when
  you need to populate large object group and need to switch between
  libraries to find objects. Switching to another library or
  accidentally clicking on a wrong object in the tree does not cause
  editor to switch.
</p>

<p>
  <b>"Single rule compile"</b>: After you select a rule in policy or
  NAT rule set, you can compile it and see the result in the editor
  panel immediately if you hit "X" on the keyboard or use context menu
  that appears if you click right mouse button. The result is shown in
  the editor panel immediately. To select a rule click anywhere in it
  (any rule element, not just rule number).
</p>

<p>
  A new <b>"Filter"</b> input field is located above the object tree.
  Typing fragment of the name in this field automatically limits set
  of objects shown in the tree to those that match what was typed. The
  filter maintain history of strings entered in it for the duration of
  the session.
</p>

<p>
  Right above the panel showing rules there are now two new buttons. These
  allow you to compile and install policy for the firewall object shown 
  in the rules panel at the moment. The same functions are available via context
  menu associated with the firewall or cluster object in the object
  tree, but these buttons are easier to use.
</p>

<p>
  The GUI can show <b>brief summary of object attributes</b> in the
  second column in the object tree. This is controlled by a checkbox
  in the global preferences dialog, tab "Objects". This is off by
  default. The first column always shows object icon and its name, the
  second (optional) column shows its attributes. Interface label is
  shown in the second column. The width of both columns in the tree is
  set automatically to accommodate all the text, then can be adjusted
  by the user using mouse. Column width is saved in settings and will
  be restored upon program restart. Column width is saved per-file,
  per-library.
</p>

<p>
  <b>Password caching</b>: Built-in installer can remember
  firewall password (and enable password for Ciscos) for the
  duration of the session. Passwords are never stored permanenetly
  in any form, encrypted or plain text. You need to enter
  password once when you activate generated policy. If you keep
  the program open and need to modify and activate policy again, the
  password fields in the installer dialog can be filled
  automatically. The feature is optional and is off by default.
  Cached passwords are associated with the firewall object and
  account name used to activate policy.
</p>

<p>
  The program supports <b>new types of interfaces</b>: VLAN, bridge,
  bonding. This is fully implemented for Linux and partially for other
  platforms.  VLANs are added as child objects of an interface, like
  so:
</p>

<img src="vlan_interfaces.png" style="float: left; padding: 10px;">

<p>
  The GUI checks the name of the vlan subinterface against  naming convention
  for vlan interfaces on the chosen OS. For example, both "eth0.100" and "vlan100"
  are supported on Linux, while on Cisco IOS or PIX it should be 
  "FastEthernet0/1.101"
</p>

<p>
  See <a href="#bridge">below</a> for more details on the bridge interfaces implementation.
</p>

<p>
  The program can <b>generate commands to confgiure vlans, bridges and
    bonding interfaces</b> on Linux. This is off by default and
    controlled by checkboxes in the "script" tab of the firewall
    object dialog. Generated script adds and removes vlans, bridges,
    bridge ports, bond and bond slaves incrementally. That is, the
    script analyses existing vlan interfaces and compares them with
    vlan interfaces defined in the Firewall Builder GUI and then adds
    new ones and removes those that do not exist in fwbuilder. The
    same algorithm is used to create bridges, add or remove bridge
    ports and create bonds and then add or remove slave interfaces.
</p>

<p>
  <b>Configlets</b>: generated firewall script (for all platforms) is assembled
  from small fragments we call "configlets". These fragmens are located in the
  /usr/share/fwbuilder/configlets (on Linux). Each configlet is a template
  that uses specially defined macros which the program replaces with actual
  strings and values when it generates firewall configuration. There are separate
  templates for different firewall platforms and for different parts of the 
  configuration file to be created. Supported macros  include simple variable
  expansion and conditional "If - then" construct. You can override configlets
  we provide with your own if you create directory "fwbuilder/configlets" in your
  home directory and place files with the same name there. This way, you can change
  vritually all aspecs of generated confgiuration file.
</p>



<a name="cluster"></a>
<h2>Support for High Availability configurations</h2>

<p>
  Test data file <b>cluster.fwb</b> with examples of different cluster
  configurations <a href="http://www.fwbuilder.org/examples/cluster.fwb">is available for download here</a>.
</p>

<p>
New object type "Cluster" (located under Clusters in the tree)
represents the HA pair.  You configure policy and NAT rules in the
rule sets of this object rather than in the actual firewalls.
</p>

<p>
  Here is what you need to do to set up HA configuration:
</p>

<p>
  <ul>
    <li>Create your firewall objects. Assign platform and host os and
      name interfaces as usual. Do not add any policy or NAT
      rules. These are your real (member) firewalls. Interfaces should
      have their real IP addresses (not CARP or VRRP addresses).
    </li>

    <li>
      Create a Cluster object which you configure with proper platform
      and host OS. Use the usual "New Object" menu or toolbar button
      to create this object. Note that in order for the firewall
      object to become a member of a cluster, their platform and host
      OS settings must match.
    </li>

    <li>
      The program guides you through the process of creation of the
      new Cluster object using wizard-like dialog. You start with the
      list of firewall objects where you choose which firewalls should
      become members of the cluster. Next, the program finds
      interfaces of the member firewalls that have the same name and
      can be part of the cluster and creates cluster interfaces with
      the same name. Not all interfaces are eligible, for example
      bridge ports, bonding interface slaves or parents of vlan
      interfaces can not be used for the cluster. Cluster interfaces
      define failover groups. You can add, remove or rename cluster
      interfaces, as well as change which interfaces of the member
      firewalls are used with each one. On the next page of the wizard
      you can change failover protocols and add, remove or change IP
      addresses of cluster interfaces. Not all failover protocols
      require IP addresses, for example VRRP or CARP do but heartbeat
      or OpenAIS don't. Finally, you can choose to use policy and NAT
      rules of one of the member firewalls to populate Policy and NAT
      rule sets of the new cluster. If this is done, all references to
      the original member firewall and its interfaces in rules are
      replaced with references to the cluster and its interfaces. The
      program also creates backup copies of the member firewall
      objects with the name with suffux "-bak" and clears Policy and
      NAT rule sets of the member firewall objects used with the
      cluster before new cluster is created.
    </li>

    <li>
      The Cluster object gets carp or vrrp interfaces. Name them
      "carp0", "carp1", "vrrp0", "vrrp1" or whatever indexes they have
      on your machines. You can add CARP/VRRP password and VRID at the
      same time, but if you don't, you can add them later.
    </li>

    <li>
      If you use heatbrat or OpenAIS (on Linux) for failover, cluster
      interfaces should have the same names as corresponding member
      firewall interfaces. In this case, cluster interfaces are
      virtual entities that represent interfaces of the corresponding
      member firewalls. The program will make substitution when it
      compiles rules. This is also how it works for PIX failover
      configuration.
    </li>

    <li>
      Each cluster interface has child "Failover group" object with
      the name "firewall:carp0:members" or similar.  This is where you
      configure associated member firewall interfaces.  Double click
      this object in the tree and then click "Manage Members" button
      in the dialog. Select interfaces of the member firewalls in the
      panel on the left hand side and click arrow button to add them
      to the list on the right. Use checkbox to select master. Click
      OK when done. The platform and host OS of the cluster object and
      members must match, otherwise firewall objects do not appear in
      the "members" dialog panel.
    </li>

    <li>
      Besides interfaces, the Cluster object has a new child object
      "State Sync Group". This group represents state synchronization
      protocol. Currently <b>pfsync</b> is supported for OpenBSD and
      <b>conntrackd</b> for Linux. To configure, double click it in
      the tree to open it in the dialog and click "Manage
      Members". Select interfaces of the member firewalls in the panel
      on the left hand side and click arrow button to add them to the
      list on the right. Use checkbox to select master. Click OK when
      done. They should appear in the "members" table in the State
      Sync Group dialog. The platform and host OS of the cluster
      object and members must match, otherwise firewall objects do not
      appear in the "members" dialog panel.
    </li>

    <li>
      Button "Edit protocol parameters" allows you to edit CARP or
      VRRP password, VHID and other parameters for the failover
      protocol. This is where you can configure na ddress and port for
      heartbeat and OpenAIS and other protocol-specific parameters.
    </li>

    <li>
      There are few new checkboxes in the "Script" tab of the firewall object
      dialog. These allow you to control whether the program will add
      shell commands to create and configure vrrp/carp interfaces.
    </li>

    <li>
      Compile by clicking right mouse button on the cluster object and
      using menu item "Compile". This will in fact compile each member
      firewall separately so you'll get .fw and .conf files for both
      of them.
    </li>

    <li>
      Again, you configure all the rules in the policy and NAT rule
      sets that belong to the cluster object. If you put cluster's
      interfaces in rules, the program replaces them with interfaces
      of the member firewall when it compiles rules. If you put
      cluster object in a rule, it is like if you put member firewall
      object there instead, except the program automatically picks the
      member firewall it compiles the policy for.
    </li>
  </ul>
</p>

<a name="pix_cluster"></a>
<h2>Cluster configuration for PIX</h2>

<p>
  Firewall Builder supports PIX "lan based" failover configuration.
  Unlike in Linux or BSD, where each interface of the firewall runs
  its own instance of failover protocol, PIX runs one instance of
  failover protocol over dedicated interface. PIX can also run state
  synchronization protocol over the same or another dedicated
  interface. These dedicated interfaces should be connected via
  separate switch and do not see regular traffic. Here is how this is
  implemented in Firewall Builder:
</p>

<p>
  <ul>
    <li>Like with all other supported firewall platforms, interface
      objects that belong to a cluster object serve to establish
      association between actual interfaces of the member
      firewalls. Cluster interface object should have the same name as
      corresponding member firewall interfaces. It should have
      Failover Group child object which should be configured with
      interfaces of the member firewalls. You can create Failover
      Group object using context menu item "Add Failover Group", the
      menu appears when you right mouse click on the cluster interface
      object. Here is how it should look like:
    </li>

    <p>
      <img src="cluster_interfaces.png"/>
    </p>

    <li>Interface that is configured for the failover on the member
      firewall should be marked as "Dedicated Failover". Use checkbox
      with this name in the interface object dialog to do this.
    </li>

    <li>
      Cluster interface that corresponds to the failover interface of
      the members should be configured with protocol "PIX failover
      protocol". Click on the "Edit protocol parameters" button to edit
      timeout, polltime and the key.
    </li>
      
    <li>Cluster interfaces that represent regular interfaces of the
      members also must have failover group objects; that is where you
      add interfaces of the member firewalls. There is no need to
      configure protocol in these failover groups because PIX does not
      run it over these interfaces. Regular interfaces should not be
      marked as "Dedicated Failover".
    </li>
    
    <li>Cluster object should have State Synchronization group child
      object. Create it using conext menu "Add State Synchronization
      Group" item if this object does not exist. In this object you
      need to configure member interfaces that should be used for
      state synchronization. You can use separate dedicated interfaces
      or the same interfaces used for failover. If these are separate,
      corresponding interface objects of the member firewalls must be
      marked as "Dedicated Failover".
    </li>

    <li>One of the member firewall interfaces used in the State
      Synchronization group must be marked as "master". This is where
      you define which PIX unit is going to be the primary and which
      is going to be the secondary in the HA pair.
    </li>

    <li>
      Here is an example of the state synchronization and failover using
      the same interface Ethernet2:
      <p>
        <img src="state_sync_configuration.png"/>
      </p>
    </li>

    <li>Dedicated failover interfaces of the member firewalls must
      have IP addresses and these addresses must be different but
      belong to the same subnet.
    </li>


  </ul>
</p>

<a name="bridge"></a>
<h2>Changes in the support for bridging firewalls</h2>

<p>
  Skip this if you do not use Firewall Builder to configure iptables
  firewalls in bridging configuration. Otherwise, please read on.
</p>

<p>
  Previous versions of Firewall Builder provided an attribute "bridge
  port" in the dialog of the Interface object. If an interface marked
  as "bridge port" was used in the "Interface" column of a policy
  rule, fwbuilder policy compiler used "--physdev-in" or
  "--physdev-out" option instead of conventional "-i" or "-o"
  option. The attribute "bridge port" has been deprecated in the new
  version. You need to make changes to your firewall and interface
  objects manually in order to make your old configurations compile
  properly with new version of Firewall Builder.
</p>

<p>
  First, check if you have an interface object to represent the
  bridge. Usually it will have a name <b>br0</b> or similar. If you
  do not have this interface object in the firewall in Firewall
  Builder, please create it. Regardless whether this object existed
  before or you just created it, open it in the editor and click
  <b>"Advanced Interface Settings"</b> button in the dialog. This
  button and the dialog it opens are new in this version of the
  program. In the dialog that appears use drop-down menu "Device Type"
  to set its type to <b>"Bridge"</b>. Then click "OK" to close the
  dialog and save configuration.
</p>

<p>
  Next, find interface objects that should represent bridge ports and
  simply drag them and drop under the interface <b>br0</b> (copy/paste
  works too). In the end, these interfaces become "children"
  of <b>br0</b> and should be located in the branch of the tree rooted
  at <b>br0</b>. The program displays a comment "bridge port" next to
  the name of an interface like this in the tree. Here is how it looks
  like:
</p>

<img src="new_bridge_interfaces.png" style="float: left; margin: 10px;">

<p>
  In this configuration we have bridge interface <b>br0</b> and two
  bridge ports <b>eth0</b> and <b>eth1</b>. Note how <b>eth0</b>
  and <b>eth1</b> are located in the tree under <b>br0</b>, on the
  same level as its ip address object.
</p>

<p>
  This is it, bridge port interfaces will be recognized by the program
  again and it will generate proper iptables configuration.
</p>



