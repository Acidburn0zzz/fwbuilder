#-*- mode: makefile; tab-width: 4; -*-
#
########## fwbuilder/qmake.inc.in
#
QTDIR = $$(QTDIR)
TEMPLATE = app
SO_VERSION = @LIBFWBUILDER_SOLIB_VERSION@
DEFINES += $$(DEFINES)
LANGUAGE = C++
UI_DIR = ui
MANDIR = @MANDIR@
DOCDIR = @DOCDIR@

HAVE_QTDBUS = @HAVE_QTDBUS@
HAVE_CPPUNIT = @HAVE_CPPUNIT@
CPPUNIT_CFLAGS = @CPPUNIT_CFLAGS@
CPPUNIT_LIBS = @CPPUNIT_LIBS@

unix {
    PREFIX = @PREFIX@

    ANTLR_INCLUDEPATH =  @ANTLR_INCLUDEPATH@
    ANTLR_LIBS =  @ANTLR_LIBS@
    FWBPARSER_LIB = ../parsers/libfwbparser.a
    FWTRANSFER_LIB = ../fwtransfer/libfwtransfer.a

    QMAKE_CXX = @CCACHE@ @DISTCC@ $$QMAKE_CXX

    !macx {

        UI_DIR = .ui
        MOC_DIR = .moc
        OBJECTS_DIR = .obj

        exec_prefix = @EXEC_PREFIX@
        DESTDIR =
        ICONSDIR = @ICONSDIR@

        INCLUDEPATH += .. ../.. $$(INCLUDEPATH) @LIBFWBUILDER_INCLUDEPATH@

        LIBS_FWCOMPILER = @LIBFWBUILDER_LIBS_FWCOMPILER@
        LIBS_FWBUILDER = @LIBFWBUILDER_LIBS_FWBUILDER@

        target.path = $$PREFIX/bin
        dtd.path = @TEMPLATE_DIR@/
        migration.path = @TEMPLATE_DIR@/migration
        doc.path = @DOCDIR@
        datadir.path   = @DATADIR@

        res.path = @RES_DIR@
        res_os.path = $$res.path/os/
        res_platform.path = $$res.path/platform/
        res_help_C.path = $$res.path/help/C
        res_help_en_US.path = $$res.path/help/en_US
        res_desktop.path = @DATADIR@/applications/
        res_configlets.path = $$res.path/configlets

        # INSTALLS += icns
        LIBS += $$LIBS_FWBUILDER @LIBS@

        PKGLOCALEDIR = $$res.path/locale

        LIBS += $$LIBS_FWBUILDER @LIBS@

        CONFIG += warn_on debug
        QMAKE_CFLAGS_DEBUG += -Wno-unused-parameter
        QMAKE_CFLAGS_RELEASE += -Wno-unused-parameter
        QMAKE_CXXFLAGS_DEBUG += -Wno-unused-parameter
        QMAKE_CXXFLAGS_RELEASE += -Wno-unused-parameter

    }
}

win32 {
    CONFIG -= debug
}

FWB_SIG = $$(FWB_SIG)
if (isEmpty(FWB_SIG)) { FWB_SIG=26932 }
DEFINES += FWB_SIG=$$FWB_SIG

exists(qmake2.inc) {
  include(qmake2.inc)
}

exists(build_num) {
	include(build_num)
}
if (isEmpty(BUILD_NUM)) {
	GIT_BRANCH=$$system(git branch | grep '\\*' | cut -c3-)
	GIT_COMMIT=$$system(git show --abbrev-commit -1 --pretty=oneline --shortstat | head -1 | cut -c1-7)
	BUILD_NUM="\"$$GIT_BRANCH:$$GIT_COMMIT\""
}

DEFINES += BUILD_NUM=$$BUILD_NUM

INSTALLS += target
